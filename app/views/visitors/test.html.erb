<style>
#calendar {
    max-width: 100%;
}
</style>
<%= javascript_tag do %>
  $(document).ready(function() {
  
    $('#calendar').fullCalendar({

      // THIS KEY WON'T WORK IN PRODUCTION!!!
      // To make your own Google API key, follow the directions here:
      // http://fullcalendar.io/docs/google_calendar/
      googleCalendarApiKey: 'AIzaSyBEgUzcWCBGR0OWJ8Up1eJKlJauJDDZPdA',
      theme: false,
      // US Holidays
      eventSources: [
      ],  
      eventRender: function(event,element)
      {
        if(event.description){
        
          element.find('.fc-title').append("<br/>" + event.description); 
        }
      },
      eventClick: function(event) {
        // opens events in a popup window
        window.open(event.url, 'gcalevent', 'width=700,height=600');
        return false;
      },
      dayClick: function(date,allDay,jsEvent,view){

      $('#calendar').fullCalendar('changeView','agendaDay')

      $('#calendar').fullCalendar('gotoDate',date);
      },

      header: {
        left: 'title',
        center: 'month,agendaWeek,agendaDay',
        right: 'agendaDay prev, next'
      },
        
      
      loading: function(bool) {
        $('#loading').toggle(bool);
      }
      
    });
    
  });

<% end %>
<%= javascript_tag do %>
    $(document).ready(function(){
        <% Calendar.all.each do |calendar| %>
          $('#<%=calendar.id%>').removeClass('btn btn-default');
          $('#<%=calendar.id%>').addClass('btn btn-success');
          $( "span", '#<%=calendar.id%>' ).removeClass('glyphicon glyphicon-unchecked');
          $( "span", '#<%=calendar.id%>' ).addClass('glyphicon glyphicon-check');

          if($('#<%=calendar.id%>').val()=='false'){
          $('#<%=calendar.id%>').val('true');
          $('#calendar').fullCalendar( 'addEventSource', '<%=calendar.url%>' );
          }
          $('#calendar').fullCalendar( 'rerenderEvents' );
        <% end %>   
        $('#selectAll').click(function(){
            <% Calendar.all.each do |calendar| %>
              $('#<%=calendar.id%>').removeClass('btn btn-default');
              $('#<%=calendar.id%>').addClass('btn btn-success');
              $( "span", '#<%=calendar.id%>' ).removeClass('glyphicon glyphicon-unchecked');
              $( "span", '#<%=calendar.id%>' ).addClass('glyphicon glyphicon-check');

              if($('#<%=calendar.id%>').val()=='false'){
              $('#<%=calendar.id%>').val('true');
              $('#calendar').fullCalendar( 'addEventSource', '<%=calendar.url%>' );
              }
              $('#calendar').fullCalendar( 'rerenderEvents' );
            <% end %>           
        });
        $('#clearAll').click(function(){
            <% Calendar.all.each do |calendar| %>
              $('#<%=calendar.id%>').removeClass('btn btn-success');
              $('#<%=calendar.id%>').addClass('btn btn-default');
              $( "span", '#<%=calendar.id%>' ).removeClass('glyphicon glyphicon-check');
              $( "span", '#<%=calendar.id%>' ).addClass('glyphicon glyphicon-unchecked');

              if($('#<%=calendar.id%>').val()!='false'){
              $('#<%=calendar.id%>').val('false');
              $('#calendar').fullCalendar( 'removeEventSource', '<%=calendar.url%>' );
              }
              $('#calendar').fullCalendar( 'rerenderEvents' );
            <% end %>           
        });
    <% Calendar.all.each do |calendar| %>
    $('#<%=calendar.id%>').click(function(){
      $(this).toggleClass('btn btn-default');
      $(this).toggleClass('btn btn-success');
      $( "span", this ).toggleClass('glyphicon glyphicon-unchecked');
      $( "span", this ).toggleClass('glyphicon glyphicon-check');

      if($(this).val()=='false'){
      $(this).val('true');

      $('#calendar').fullCalendar( 'addEventSource', {url:'<%=calendar.url%>',color: '#3E8F3E' });
      }
      else{
      $(this).val('false');
      $('#calendar').fullCalendar( 'removeEventSource', '<%=calendar.url%>' );
      }
      $('#calendar').fullCalendar( 'rerenderEvents' );
    });
    <% end %>
});
<% end %>
    <div id="wrapper">

        <!-- Navigation -->
        <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="index.html">SB Admin</a>
            </div>
            <!-- Top Menu Items -->
            <ul class="nav navbar-right top-nav">
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-envelope"></i> <b class="caret"></b></a>
                    <ul class="dropdown-menu message-dropdown">
                        <li class="message-preview">
                            <a href="#">
                                <div class="media">
                                    <span class="pull-left">
                                        <img class="media-object" src="http://placehold.it/50x50" alt="">
                                    </span>
                                    <div class="media-body">
                                        <h5 class="media-heading"><strong>John Smith</strong>
                                        </h5>
                                        <p class="small text-muted"><i class="fa fa-clock-o"></i> Yesterday at 4:32 PM</p>
                                        <p>Lorem ipsum dolor sit amet, consectetur...</p>
                                    </div>
                                </div>
                            </a>
                        </li>
                        <li class="message-preview">
                            <a href="#">
                                <div class="media">
                                    <span class="pull-left">
                                        <img class="media-object" src="http://placehold.it/50x50" alt="">
                                    </span>
                                    <div class="media-body">
                                        <h5 class="media-heading"><strong>John Smith</strong>
                                        </h5>
                                        <p class="small text-muted"><i class="fa fa-clock-o"></i> Yesterday at 4:32 PM</p>
                                        <p>Lorem ipsum dolor sit amet, consectetur...</p>
                                    </div>
                                </div>
                            </a>
                        </li>
                        <li class="message-preview">
                            <a href="#">
                                <div class="media">
                                    <span class="pull-left">
                                        <img class="media-object" src="http://placehold.it/50x50" alt="">
                                    </span>
                                    <div class="media-body">
                                        <h5 class="media-heading"><strong>John Smith</strong>
                                        </h5>
                                        <p class="small text-muted"><i class="fa fa-clock-o"></i> Yesterday at 4:32 PM</p>
                                        <p>Lorem ipsum dolor sit amet, consectetur...</p>
                                    </div>
                                </div>
                            </a>
                        </li>
                        <li class="message-footer">
                            <a href="#">Read All New Messages</a>
                        </li>
                    </ul>
                </li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-bell"></i> <b class="caret"></b></a>
                    <ul class="dropdown-menu alert-dropdown">
                        <li>
                            <a href="#">Alert Name <span class="label label-default">Alert Badge</span></a>
                        </li>
                        <li>
                            <a href="#">Alert Name <span class="label label-primary">Alert Badge</span></a>
                        </li>
                        <li>
                            <a href="#">Alert Name <span class="label label-success">Alert Badge</span></a>
                        </li>
                        <li>
                            <a href="#">Alert Name <span class="label label-info">Alert Badge</span></a>
                        </li>
                        <li>
                            <a href="#">Alert Name <span class="label label-warning">Alert Badge</span></a>
                        </li>
                        <li>
                            <a href="#">Alert Name <span class="label label-danger">Alert Badge</span></a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#">View All</a>
                        </li>
                    </ul>
                </li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-user"></i> John Smith <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        <li>
                            <a href="#"><i class="fa fa-fw fa-user"></i> Profile</a>
                        </li>
                        <li>
                            <a href="#"><i class="fa fa-fw fa-envelope"></i> Inbox</a>
                        </li>
                        <li>
                            <a href="#"><i class="fa fa-fw fa-gear"></i> Settings</a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#"><i class="fa fa-fw fa-power-off"></i> Log Out</a>
                        </li>
                    </ul>
                </li>
            </ul>
            <!-- Sidebar Menu Items - These collapse to the responsive navigation menu on small screens -->
            <div class="collapse navbar-collapse navbar-ex1-collapse">
                <ul class="nav navbar-nav side-nav">
                    <li class="active">
                        <a href="index.html"><i class="fa fa-fw fa-dashboard"></i> Dashboard</a>
                    </li>
                    <li>
                        <a href="charts.html"><i class="fa fa-fw fa-bar-chart-o"></i> Charts</a>
                    </li>
                    <li>
                        <a href="tables.html"><i class="fa fa-fw fa-table"></i> Tables</a>
                    </li>
                    <li>
                        <a href="forms.html"><i class="fa fa-fw fa-edit"></i> Forms</a>
                    </li>
                    <li>
                        <a href="bootstrap-elements.html"><i class="fa fa-fw fa-desktop"></i> Bootstrap Elements</a>
                    </li>
                    <li>
                        <a href="bootstrap-grid.html"><i class="fa fa-fw fa-wrench"></i> Bootstrap Grid</a>
                    </li>
                    <li>
                        <a href="javascript:;" data-toggle="collapse" data-target="#demo"><i class="fa fa-fw fa-arrows-v"></i> Dropdown <i class="fa fa-fw fa-caret-down"></i></a>
                        <ul id="demo" class="collapse">
                        <% Calendar.where(typeOf:"Other").each do |calendar| %>
                            <li>
                                <button id="<%=calendar.id%>" type="button" class="btn btn-default btn-block" value="false">
                                <span class="glyphicon glyphicon-unchecked" aria-hidden="true"></span> 
                                <%= calendar.name %>
                                </button>
                            </li>
                        <% end %>
                        </ul>
                    </li>
                    <li>
                        <a href="blank-page.html"><i class="fa fa-fw fa-file"></i> Blank Page</a>
                    </li>
                    <li>
                        <a href="index-rtl.html"><i class="fa fa-fw fa-dashboard"></i> RTL Dashboard</a>
                    </li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </nav>

        <div id="page-wrapper">

            <div id='loading'>loading...</div>
            <div class='container-fluid'>
                <div class="row">
                    <div class='col-md-12'>
                        <div id='calendar'></div>
                    </div>
                </div>
                <div class="row">
                    <div class='col-md-4'>
                        <div class='row'>
                            <div class='col-md-12'>
                                <!-- Button trigger modal -->
                                <button type="button" class="btn btn-primary btn-lg btn-block" data-toggle="modal" data-target="#myModal">
                                  Add a Calendar!
                                </button>
                            </div>
                            <div class='col-md-6'>
                                <!-- Button trigger modal -->
                                <button type="button" id="selectAll" class="btn btn-primary btn-lg btn-block" value="false">
                                  Select All
                                </button>
                            </div>
                            <div class='col-md-6'>
                                <!-- Button trigger modal -->
                                <button type="button" id="clearAll" class="btn btn-primary btn-lg btn-block" value="false">
                                  Clear All
                                </button>
                            </div>
                        </div>
                        <div class='row'>
                            <div class='col-md-6'>
                                <h2> Entertainment </h2>
                                <% Calendar.where(typeOf:"Entertainment").each do |calendar| %>
                                    <button id="<%=calendar.id%>" type="button" class="btn btn-default btn-block" value="false">
                                    <span class="glyphicon glyphicon-unchecked" aria-hidden="true"></span> 
                                    <%= calendar.name %>
                                    </button>
                                <% end %>
                            </div>
                            <div class='col-md-6'>
                                <h2> Sports </h2>
                                <% Calendar.where(typeOf:"Sports").each do |calendar| %>
                                    <button id="<%=calendar.id%>" type="button" class="btn btn-default btn-block" value="false">
                                    <span class="glyphicon glyphicon-unchecked" aria-hidden="true"></span> 
                                    <%= calendar.name %>
                                    </button>
                                <% end %>
                            </div>
                        </div>
                        <div class='row'>
                            <div class='col-md-6'>
                                <h2> Food & Drinks </h2>
                                <% Calendar.where(typeOf:"Food and Drinks").each do |calendar| %>
                                    <button id="<%=calendar.id%>" type="button" class="btn btn-default btn-block" value="false">
                                    <span class="glyphicon glyphicon-unchecked" aria-hidden="true"></span> 
                                    <%= calendar.name %>
                                    </button>
                                <% end %>
                            </div>
                            <div class='col-md-6'>
                                <h2> Student Orgs </h2>
                                <% Calendar.where(typeOf:"School Events/Student Organizations").each do |calendar| %>
                                    <button id="<%=calendar.id%>" type="button" class="btn btn-default btn-block" value="false">
                                    <span class="glyphicon glyphicon-unchecked" aria-hidden="true"></span> 
                                    <%= calendar.name %>
                                    </button>
                                <% end %>
                            </div>
                        </div>
                        <div class='row'>
                            <div class='col-md-6'>
                                <h2> Others </h2>
                                <% Calendar.where(typeOf:"Other").each do |calendar| %>
                                    <button id="<%=calendar.id%>" type="button" class="btn btn-default btn-block" value="false">
                                    <span class="glyphicon glyphicon-unchecked" aria-hidden="true"></span> 
                                    <%= calendar.name %>
                                    </button>
                                <% end %>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Modal -->
            <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
              <div class="modal-dialog" role="document">
                <div class="modal-content">
                  <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h1 class="modal-title" id="myModalLabel">Add a Google Calendar!</h1>
                  </div>
                  <div class="modal-body">
                    <%= form_tag visitors_addcalendar_path do %>
                        <h3> Name </h3>
                        <%= text_field_tag(:name,nil,style:"width:100%") %><br>
                        <h3> Type </h3>
                        <%= select_tag :type, options_for_select(types), size:5, style:"width:100%" %><br>
                        <h3> Description </h3>
                        <%= text_area_tag(:desc,nil,size:"73x5") %><br>
                        <h3> URL </h3>
                        <%= text_field_tag(:url,nil,style:"width:100%") %><br>
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        <%= submit_tag "Submit!", :class => "submit" %>
                    <% end %>
                  </div>
                </div>
              </div>
            </div>
            <!-- /.container-fluid -->

        </div>
        <!-- /#page-wrapper -->

    </div>
    <!-- /#wrapper -->